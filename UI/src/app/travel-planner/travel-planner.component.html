<div class="app-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <h2 class="sidebar-title">⚙️ Options</h2>
    <div class="search-mode-section">
      <h3>Search Mode</h3>
      <div class="radio-group">
        <label class="radio-option">
          <input type="radio" [(ngModel)]="searchMode" value="complete" name="searchMode">
          <span>Complete (Flights + Hotels + Itinerary)</span>
        </label>
        <label class="radio-option">
          <input type="radio" [(ngModel)]="searchMode" value="flights" name="searchMode">
          <span>Flights Only</span>
        </label>
        <label class="radio-option">
          <input type="radio" [(ngModel)]="searchMode" value="hotels" name="searchMode">
          <span>Hotels Only</span>
        </label>
      </div>
    </div>
    <div class="sidebar-footer">
      <p>AI-Powered Travel Planner v2.0</p>
      <p>© 2025 Travel AI Solutions</p>
    </div>
  </div>
  <!-- Main Content -->
  <div class="main-content">
    <header class="header">
      <h1>✈️ AI-Powered Travel Planner</h1>
      <p>Find flights, hotels, and get personalized recommendations with AI! Create your perfect travel itinerary in seconds.</p>
    </header>
    <!-- Search Form -->
    <form [formGroup]="travelForm" (ngSubmit)="onSubmit()" class="search-form">
      <div class="form-grid">
        <!-- Flight Details -->
        <div class="form-section">
          <h2>🛫 Flight Details</h2>
          <div class="form-group">
            <label>Departure Airport (IATA code)</label>
            <input type="text" formControlName="origin" class="form-control" placeholder="ATL">
          </div>
          <div class="form-group">
            <label>Arrival Airport (IATA code)</label>
            <input type="text" formControlName="destination" class="form-control" placeholder="LAX">
          </div>
          <div class="form-group">
            <label>Departure Date</label>
            <input type="date" formControlName="outboundDate" class="form-control">
          </div>
          <div class="form-group">
            <label>Return Date</label>
            <input type="date" formControlName="returnDate" class="form-control">
          </div>
        </div>
        <!-- Hotel Details -->
        <div class="form-section">
          <h2>🏨 Hotel Details</h2>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="useFlightDestination" [ngModelOptions]="{standalone: true}">
              Use flight destination for hotel
            </label>
          </div>
          <div class="form-group" *ngIf="!useFlightDestination">
            <label>Hotel Location</label>
            <input type="text" formControlName="location" class="form-control">
          </div>
          <div class="form-group" *ngIf="useFlightDestination">
            <div class="info-message">
              Using flight destination ({{travelForm.get('destination')?.value}}) for hotel search
            </div>
          </div>
          <div class="form-group">
            <label>Check-In Date</label>
            <input type="date" formControlName="checkInDate" class="form-control">
          </div>
          <div class="form-group">
            <label>Check-Out Date</label>
            <input type="date" formControlName="checkOutDate" class="form-control">
          </div>
        </div>
      </div>
      <div class="submit-section">
        <button type="submit" class="search-btn" [disabled]="loading || travelForm.invalid">
          <span *ngIf="loading">Searching...</span>
          <span *ngIf="!loading">🔍 Search</span>
        </button>
      </div>
    </form>
    <!-- Loading Spinner -->
    <div *ngIf="loading" class="loading-spinner">
      <div class="spinner"></div>
      <p>Searching for the perfect travel options for you...</p>
    </div>
    <!-- Error Messages -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
    <!-- Results -->
    <div *ngIf="searchResults && !loading" class="results-container">
      <!-- Tabs -->
      <div class="tabs">
        <button *ngIf="searchMode !== 'hotels'" 
                class="tab-button" 
                [class.active]="activeTab === 'flights'"
                (click)="activeTab = 'flights'">
          ✈️ Flights
        </button>
        <button *ngIf="searchMode !== 'flights'" 
                class="tab-button" 
                [class.active]="activeTab === 'hotels'"
                (click)="activeTab = 'hotels'">
          🏨 Hotels
        </button>
        <button class="tab-button" 
                [class.active]="activeTab === 'recommendations'"
                (click)="activeTab = 'recommendations'">
          🏆 AI Recommendations
        </button>
        <button *ngIf="searchMode === 'complete' && searchResults.itinerary" 
                class="tab-button" 
                [class.active]="activeTab === 'itinerary'"
                (click)="activeTab = 'itinerary'">
          📅 Itinerary
        </button>
      </div>
      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Flights Tab -->
        <div *ngIf="activeTab === 'flights' && searchMode !== 'hotels'" class="flights-section">
          <h3>✈️ Available Flights from {{travelForm.get('origin')?.value}} to {{travelForm.get('destination')?.value}}</h3>
          <div *ngIf="searchResults.flights.length > 0" class="flights-grid">
            <div *ngFor="let flight of searchResults.flights; let i = index" class="flight-card">
              <h4>✈️ {{flight.airline}} - {{flight.stops}} Flight</h4>
              <div class="flight-details">
                <p>🕒 <strong>Departure:</strong> {{flight.departure}}</p>
                <p>🕘 <strong>Arrival:</strong> {{flight.arrival}}</p>
                <p>⏱️ <strong>Duration:</strong> {{flight.duration}}</p>
                <p>💰 <strong>Price:</strong> <strong>₹{{flight.price}}</strong></p>
                <p>💺 <strong>Class:</strong> {{flight.travel_class}}</p>
              </div>
              <div *ngIf="flight.legs && flight.legs.length > 0" class="flight-legs">
                <h5>Flight Legs:</h5>
                <ul>
                  <li *ngFor="let leg of flight.legs">
                    <span>🛫 <strong>{{leg.departure_airport}}</strong> at {{leg.departure_time}}</span>
                    <span>→ 🛬 <strong>{{leg.arrival_airport}}</strong> at {{leg.arrival_time}}</span>
                    <span> | ✈️ {{leg.airline}} ({{leg.flight_number}}), {{leg.travel_class}}, {{leg.duration}} min</span>
                  </li>
                </ul>
              </div>
              <div *ngIf="flight.layovers && flight.layovers.length > 0" class="flight-layovers">
                <h5>Layovers:</h5>
                <ul>
                  <li *ngFor="let lay of flight.layovers">
                    <span>🛑 <strong>{{lay.airport}}</strong> ({{lay.airport_id}}) - {{lay.duration}} min<span *ngIf="lay.overnight"> (Overnight)</span></span>
                  </li>
                </ul>
              </div>
              <button class="select-btn">🔖 Select This Flight</button>
            </div>
          </div>
          <div *ngIf="searchResults.flights.length === 0" class="no-results">
            No flights found for your search criteria.
          </div>
        </div>
        <!-- Hotels Tab -->
        <div *ngIf="activeTab === 'hotels' && searchMode !== 'flights'" class="hotels-section">
          <h3>🏨 Available Hotels in {{getHotelLocation()}}</h3>
          <div *ngIf="searchResults.hotels.length > 0" class="hotels-grid">
            <div *ngFor="let hotel of searchResults.hotels; let i = index" class="hotel-card">
              <h4>🏨 {{hotel.name}}</h4>
              <div class="hotel-details">
                <p>💰 <strong>Price:</strong> ₹{{hotel.price}} per night</p>
                <p>⭐ <strong>Rating:</strong> {{hotel.rating}}</p>
                <p>📍 <strong>Location:</strong> {{hotel.location}}</p>
              </div>
              <div class="hotel-actions">
                <button class="select-btn">🔖 Select</button>
                <a [href]="hotel.link" target="_blank" class="details-btn">🔗 Details</a>
              </div>
            </div>
          </div>
          <div *ngIf="searchResults.hotels.length === 0" class="no-results">
            No hotels found for your search criteria.
          </div>
        </div>
        <!-- Recommendations Tab -->
        <div *ngIf="activeTab === 'recommendations'" class="recommendations-section">
          <div *ngIf="searchMode !== 'hotels' && searchResults.ai_flight_recommendation" class="recommendation-card">
            <h3>✈️ AI Flight Recommendation</h3>
            <div markdown [data]="searchResults.ai_flight_recommendation"></div>
          </div>
          <div *ngIf="searchMode !== 'flights' && searchResults.ai_hotel_recommendation" class="recommendation-card">
            <h3>🏨 AI Hotel Recommendation</h3>
            <div markdown [data]="searchResults.ai_hotel_recommendation"></div>
          </div>
        </div>
        <!-- Itinerary Tab -->
        <div *ngIf="activeTab === 'itinerary' && searchMode === 'complete'" class="itinerary-section">
          <h3>📅 Your Travel Itinerary</h3>
          <div class="itinerary-content" markdown [data]="itineraryMarkdown"></div>
          <button class="download-btn" (click)="downloadItinerary()">📥 Download Itinerary</button>
        </div>
      </div>
    </div>
  </div>
</div>